---
title: "Intro to Bayes: Assignment"
output:
  html_document: default
  pdf_document: default
language: R
---

<!-- To render the assignment in Rmarkdown, enter the command below in the R console -->
<!-- rmarkdown::render("Class_20_Assignment.Rmd") -->

#### Due by the beginning of next class (11/16)

Save this Rmarkdown script as a file named “YourlastName_Assignment20.Rmd”. 
For each question, fill out the answer and, where requested, 
provide the relevant R code using "```" and the echo = TRUE argument.

When finished, Knit your script together into an html report, 
saved as “YourlastName_Assignment20.html” and upload the 
resulting file to the D2L site (in today’s class folder) to turn it in. 
It is due before our next class.

\

**This homework assignment will test your abilities to:**

1. think critically and creatively about Bayesian statistics

2. extrapolate from in-class exercises to apply Bayesian inference to arbitrary distributions

3. use your R skillz: function building, data visualization, etc.

\

### Question 1

1. Write down Bayes' Theorem using $D$ to denote "data" and $\theta$ to denote "the hypothesis"

$\Large p(\theta \mid D) = \frac{p(D \mid \theta)p(\theta)}{p(D)}$

2. Label the different components using the following list of concepts:
	- the posterior probability of the hypothesis
	- the marginal likelihood of the data
	- the prior probability of the hypothesis
	- the likelihood of the data given the hypothesis


$\Large \text{posterior prob of the hypothesis} = \frac{\text{the likelihood of the data given the hypothesis} \times \text{the prior probability of the hypothesis}}{\text{the marginal likelihood of the data}}$

### Question 2

If you know a child younger than 5 (or a parent of a child younger than 5), 
chances are you've heard of RSV (respiratory syncytial virus), 
a flu-like illness that infects virtually all children in their 
first few years of life. 

To detect RSV, healthcare providers generally administer antigen tests, 
which are cheaper and faster (although generally less accurate) than PCR-based tests.
The most commonly used RSV antigen test has a 91.7% sensitivity and a 98.9% specificity. 
Let's say my kid (Ilana) shows some symptoms of RSV, so we get her
an antigen test, which comes back positive. 
Given that result, what is the probability Ilana is actually infected with RSV?

In your calculations, assume the following:\

-There are ~7,000 kids under the age of 2 in Ingham County\
-Ilana can be treated as a random draw from the <2yos of Ingham County\
-over the last 10 days, the average per-day number of new detected cases of active RSV infection in Ingham County is 5\
-someone infected with RSV is infectious for 7 days\
-only 1 out of every 3 RSV infections is detected and reported.\

Answer\
Prior probability of the hypothesis = proportion of kids with RSV in Ingham county\
= Number of cases / number of kids\
```{r}
myPrior = (5*7*3)/7000
myPrior
```

Likelihood of the data given the hypothesis = likelihood of getting a positive test given RSV = .917

Marginal likelihood of the data = p(positive result)
= p(positive result | has RSV) x p(has RSV) + p(positive result | does not have RSV) x p(does not have RSV)
= 0.917 x 0.015 +  (1-0.989) x (1-0.015)
```{r}
myMarginal = 0.917*myPrior + (1-0.989)*(1-myPrior)
myMarginal
```

Posterior probability = Likelihood of the data x Prior probability of the hypothesis / marginal likelihood of the data
```{r}
myPosterior = (0.917 * myPrior)/myMarginal
myPosterior
```


### Question 3

3a) Building on the results from Question 2, 
write an R function that explores how the probability Ilana is actually infected with RSV 
given a positive result from an antigen test 
is dependent on the number of infected toddlers in Ingham County.
The function should take as its arguments: \
 -the percentage of toddlers in Ingham County who are actively infected \
 -the sensitivity of the antigen test (from Question 2)\
 -the specificity of the antigen test (from Question 2)\
 
and it should return the probability a given toddler is infected with RSV given the positive test result.


```{r}
posteriorFunction <- function(myPrior, mySensitivity, mySpecificity){
  myMarginal = mySensitivity*myPrior + (1-mySpecificity)*(1-myPrior)#get the marginal likelihood of the data
  myPosterior =  (mySensitivity * myPrior)/myMarginal
  return(myPosterior)
}

```

3b) At what background level of RSV prevalence in Ingham County does 
the probability of a given toddler actually being infected given a positive antigen test result go above 0.9?

```{r}
mySensitivity = 0.917
mySpecificity = 0.989

plot(seq(0,0.5, by = 0.01), posteriorFunction(seq(0,0.5, by = 0.01), mySensitivity, mySpecificity))
abline(h=0.9)

```